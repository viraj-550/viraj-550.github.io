<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Viraj R. Chordiya – final_project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Viraj R. Chordiya</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Viraj_Chordiya_Resume.pdf">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="financial-econometrics-final-project" class="level1">
<h1>Financial Econometrics Final Project</h1>
<p>Viraj Chordiya 2022-11-30</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In todays volatile world, portfolio management is crucial as it helps reduce the investment strategy risk to the extent that cannot be ignored. The goal of a portfolio manager is to reduce risks and maximize returns for their clients. The aim of this project is to analyse the Direxion Daily S&amp;P 500 Bull 3X Shares (SPXL) ETF and Bank of America Corp (NYSE: BAC) stock and study an optimal portfolio to forecast Value-at-Risk. Direxion Daily S&amp;P 500 Bull 3X Shares is a 300% leveraged ETF derived from the S&amp;P 500 index and Bank of America is an evergreen stock generating steady returns. An optimum portfolio mix of these two financial assets can reduce VaR and provide handsome returns. We collect previous 10 year daily OHLC data for both the instruments from Yahoo Finance using <code>quantmod::getSymbols()</code> in R.</p>
<p>To this end, we perform the following analyses:</p>
<ol type="1">
<li>Explore the data to check for time dependence and volatility clustering.</li>
<li>Build a time series model, specifically, <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> to model each product’s log returns.</li>
<li>Fit t-distributions to the standardized errors of both models. In order to study the dependence structure of both the residues, we fit several copulas like t - Copula, Gaussian copula, Gumbel Copula, Clayton and Frank copulas and choose the best one by minimizing AIC.</li>
<li>We conduct a residual analysis on the standardized residues of the model to check for any serial correlation. Using autocorrelation plots and weighted versions of Ljung-Box test, we conclude that the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model is a good fit for the data.</li>
<li>Lastly, we utilize numerical methods to conduct Value-at-Risk forecasting of a portfolio mix of SPXL and BAC. We find that VaR increases as SPXL’s share in the portfolio increases.</li>
</ol>
<hr>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>We collect ten years daily OHLC data of Direxion Daily S&amp;P 500 Bull 3X Shares (SPXL) and Bank of America Corp (NYSE: BAC). SPXL is a three times leveraged ETF mirroring the S&amp;P 500 index. Hence, it provides a 300% of the S&amp;P 500 index’s daily return. The data is collected from Yahoo finance for period 2012/11 - 2022/11 using the <code>getSymbol()</code> function from the <code>quantmod</code> library. The table represents the summary statistics of daily adjusted closing stock price, and log returns of both the instruments.</p>

<table style="text-align:center">
<caption>
<strong>Table 1. Summary Statistics</strong>
</caption>
<tbody><tr>
<td colspan="8" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
vars
</td>
<td>
n
</td>
<td>
mean
</td>
<td>
sd
</td>
<td>
skew
</td>
<td>
kurtosis
</td>
<td>
se
</td>
</tr>
<tr>
<td colspan="8" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
SPXL
</td>
<td>
1
</td>
<td>
2,517
</td>
<td>
43.071
</td>
<td>
31.680
</td>
<td>
1.240
</td>
<td>
0.854
</td>
<td>
0.631
</td>
</tr>
<tr>
<td style="text-align:left">
BAC
</td>
<td>
2
</td>
<td>
2,517
</td>
<td>
22.633
</td>
<td>
9.738
</td>
<td>
0.591
</td>
<td>
-0.556
</td>
<td>
0.194
</td>
</tr>
<tr>
<td style="text-align:left">
SPXL_r
</td>
<td>
3
</td>
<td>
2,517
</td>
<td>
0.001
</td>
<td>
0.033
</td>
<td>
-1.525
</td>
<td>
20.383
</td>
<td>
0.001
</td>
</tr>
<tr>
<td style="text-align:left">
BAC_r
</td>
<td>
4
</td>
<td>
2,517
</td>
<td>
0.001
</td>
<td>
0.019
</td>
<td>
-0.070
</td>
<td>
9.849
</td>
<td>
0.0004
</td>
</tr>
<tr>
<td colspan="8" style="border-bottom: 1px solid black">
</td>
</tr>

</tbody></table>
<p>There are a total of 2517 observations in total. Prices and log returns of both the financial instruments are asymmetric. SPXL daily prices are extremely skewed to the right, while SPXL returns are extremely skewed to the left. Moreover, BAC daily prices are slightly skewed to the right while the returns are slightly skewed to the left. The excess kurtosis for the log returns of both assets show that returns are not normally distributed.</p>
<section id="time-series-graphs-and-distribution-plots" class="level3">
<h3 class="anchored" data-anchor-id="time-series-graphs-and-distribution-plots">Time series graphs and distribution plots</h3>
<p><img src="Final_Project_files/figure-gfm/unnamed-chunk-4-1.png" class="img-fluid"><!-- --></p>
<hr>
</section>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>Firstly, we check for weak stationarity by investigating the time series plots of log returns of both the financial instruments. Next, we conduct the Augmented Dickey Fuller (ADF) test to check for the presence of unit root.</p>
<p><img src="Final_Project_files/figure-gfm/unnamed-chunk-5-1.png" class="img-fluid"><!-- --></p>
<pre><code>## 
##  Augmented Dickey-Fuller Test
## 
## data:  daily_df$SPXL_r
## Dickey-Fuller = -13.314, Lag order = 13, p-value = 0.01
## alternative hypothesis: stationary

## 
##  Augmented Dickey-Fuller Test
## 
## data:  daily_df$BAC_r
## Dickey-Fuller = -12.962, Lag order = 13, p-value = 0.01
## alternative hypothesis: stationary</code></pre>
<p>Upon visual inspection, it looks like both the log returns are stationary. Moreover, from the ADF test, we fail to reject the null hypothesis of non-stationarity at 1% confidence.</p>
<p>In order to look for time dependency and volatility clustering of log returns of SPLX and BAC, From the graphs, it is evident that both series display time varying volatility. Moreover, volatility clusters together. For better analysis, we need to model the nonconstant volatility.<br>
<img src="Final_Project_files/figure-gfm/ggplot-1.png" class="img-fluid"><!-- --></p>
<p>From the log return graphs, it is evident that both series display time varying volatility. Moreover, ACF plots of squared series of both stocks show significant serial correlation. For better analysis, we need to model time dependence and non-constant volatility.</p>
<hr>
</section>
<section id="time-series-model" class="level2">
<h2 class="anchored" data-anchor-id="time-series-model">Time Series Model</h2>
<section id="ar1-garch11-model" class="level3">
<h3 class="anchored" data-anchor-id="ar1-garch11-model">AR(1)-GARCH(1,1) Model</h3>
<p>In order to model autocorelation and volatility clustering, we combine an AR(1) model that has a nonconstant conditional mean but a constant conditional variance with a GARCH(1,1) model that has conditional mean and the variance of data depends on the past. Additionally, in a GARCH model, conditional standard deviation exhibits more persistent periods of low and high volatility.</p>
<p>The <span class="math inline">\(AR(1) - GARCH(1,1)\)</span> is model is as follows:</p>
<p><span class="math display">\[ X_t = \mu + \phi X_{t-1} + e_t, \quad e_t =  \sigma_{t}\varepsilon_{t}, \quad \sigma^2_t = \omega + \alpha e^2_{t-1} + \beta \sigma^2_{t-1} \]</span> <span class="math display">\[ \tilde X_t = \tilde \mu + \tilde \phi \tilde X_{t-1} + \tilde e_t, \quad \tilde e_t =  \tilde \sigma_{t}\tilde \varepsilon_{t}, \quad \tilde \sigma^2_t = \tilde \omega + \tilde \alpha \tilde e^2_{t-1} + \tilde \beta \tilde \sigma^2_{t-1} \]</span> where, <span class="math inline">\(X_t\)</span> is the daily log returns of SPXL and <span class="math inline">\(\tilde X_t\)</span> is the daily log returns of BAC.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>spxl <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>SPXL_r)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>bac <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>BAC_r)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting an AR(1) + GARCH(1,1) Model</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>spxl_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>spxl_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(spxl_spec, <span class="at">data =</span> spxl)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>bac_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>bac_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(bac_spec, <span class="at">data =</span> bac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="residual-copula-modelling" class="level3">
<h3 class="anchored" data-anchor-id="residual-copula-modelling">Residual Copula Modelling</h3>
<p>In order to work with a portfolio of Direxion Daily S&amp;P 500 Bull 3X Shares (SPXL) and Bank of America Corp (BAC), we need to model both the series as a copula to extract the dependence structure between the two financial instruments. In the project, we particulary study the dependent structure of the standardized residuals of an <span class="math inline">\(AR(1) - GARCH(1,1)\)</span> model fitted to both the series.</p>
<p>First, we fit a Student t distribution to both <span class="math inline">\(\varepsilon_t\)</span> and <span class="math inline">\(\tilde \varepsilon_t\)</span> using the <code>fitdistr()</code> function from the <code>MASS</code> library.</p>
<p><img src="Final_Project_files/figure-gfm/unnamed-chunk-9-1.png" class="img-fluid"><!-- --></p>
<p>A t-distribution with df = 5 fits well to the SPXL and BAC residuals. The qqplot for both the instruments is a straight line except for a few outliers. Given that the total number of observations (n = 2517) is high enough, the outliers are a small fraction of the sample.</p>
<p>Second, we transform the residuals into marginal t - distributions and fit t-copula, Gaussian copula, Gumbel Copula, Clayton and Frank copulas. We select the best fit copula by minimizing AIC. We select t-copula as it minimizes AIC.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit t-Copula</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Ct <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start =</span> <span class="fu">c</span>(omega, <span class="dv">10</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-Likelihood</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>log_lik_t <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Ct<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>aic_t <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Ct<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(log_lik_t))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>aic_t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] -1516.137</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gaussian Copula</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Cgauss <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start=</span><span class="fu">c</span>(omega))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>log_lik_gauss <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cgauss<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>aic_gauss <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cgauss<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_gauss))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>aic_gauss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] -1411.645</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gumbel Copula</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>C_gumbel <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span>U_hat,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>log_lik_gumbel <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_gumbel<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>aic_gumbel <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_gumbel<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_gumbel))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>aic_gumbel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] -1388.311</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clayton Copula</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>C_clayton <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>log_lik_clayton <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_clayton<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>aic_clayton <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_clayton<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_clayton))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>aic_clayton</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] -1213.366</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Frank Copula</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Cfrank <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="dv">1</span>, <span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>log_lik_frank <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cfrank<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>aic_frank <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cfrank<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_frank))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>aic_frank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] -1395.349</code></pre>
<hr>
</section>
</section>
<section id="residual-analysis" class="level2">
<h2 class="anchored" data-anchor-id="residual-analysis">Residual Analysis</h2>
<p>We conduct a residual analysis on the standardized residuals <span class="math inline">\(\varepsilon_t\)</span> and <span class="math inline">\(\tilde \varepsilon\)</span> to check the fit of the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model.</p>
<p>First, we inspect the standardized residuals and squared standardized residuals for autocorrelation. The figure below plots the <code>acf()</code> function for the four series.</p>
<p><img src="Final_Project_files/figure-gfm/unnamed-chunk-12-1.png" class="img-fluid"><!-- --></p>
<p>The AR(1) + GARCH(1,1) model fits very well to SPXL and BAC. The standardized residuals and the squared standardized residuals of both the models show no significant serial correlation at 95% confidence.</p>
<p>Next we look at the following box tests to check autocorrelation</p>
<pre><code>## 
## *---------------------------------*
## *          GARCH Model Fit        *
## *---------------------------------*
## 
## Conditional Variance Dynamics    
## -----------------------------------
## GARCH Model  : sGARCH(1,1)
## Mean Model   : ARFIMA(1,0,0)
## Distribution : norm 
## 
## Optimal Parameters
## ------------------------------------
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.002425    0.000386   6.2772 0.000000
## ar1    -0.057589    0.022519  -2.5574 0.010546
## omega   0.000039    0.000005   7.2770 0.000000
## alpha1  0.234808    0.023532   9.9784 0.000000
## beta1   0.735769    0.021293  34.5548 0.000000
## 
## Robust Standard Errors:
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.002425    0.000393   6.1642 0.000000
## ar1    -0.057589    0.020538  -2.8040 0.005047
## omega   0.000039    0.000008   4.7663 0.000002
## alpha1  0.234808    0.035230   6.6651 0.000000
## beta1   0.735769    0.030382  24.2170 0.000000
## 
## LogLikelihood : 5725.412 
## 
## Information Criteria
## ------------------------------------
##                     
## Akaike       -4.5454
## Bayes        -4.5338
## Shibata      -4.5454
## Hannan-Quinn -4.5412
## 
## Weighted Ljung-Box Test on Standardized Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                      2.049  0.1523
## Lag[2*(p+q)+(p+q)-1][2]     2.124  0.1746
## Lag[4*(p+q)+(p+q)-1][5]     2.964  0.4404
## d.o.f=1
## H0 : No serial correlation
## 
## Weighted Ljung-Box Test on Standardized Squared Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                   0.004478  0.9466
## Lag[2*(p+q)+(p+q)-1][5]  0.755362  0.9121
## Lag[4*(p+q)+(p+q)-1][9]  2.391429  0.8535
## d.o.f=2
## 
## Weighted ARCH LM Tests
## ------------------------------------
##             Statistic Shape Scale P-Value
## ARCH Lag[3] 0.0006976 0.500 2.000  0.9789
## ARCH Lag[5] 1.8924782 1.440 1.667  0.4955
## ARCH Lag[7] 2.9168548 2.315 1.543  0.5294
## 
## Nyblom stability test
## ------------------------------------
## Joint Statistic:  1.4921
## Individual Statistics:              
## mu     0.06813
## ar1    0.03829
## omega  0.25550
## alpha1 0.74941
## beta1  0.80377
## 
## Asymptotic Critical Values (10% 5% 1%)
## Joint Statistic:          1.28 1.47 1.88
## Individual Statistic:     0.35 0.47 0.75
## 
## Sign Bias Test
## ------------------------------------
##                      t-value      prob sig
## Sign Bias           3.751292 0.0001799 ***
## Negative Sign Bias  0.946993 0.3437337    
## Positive Sign Bias  0.004987 0.9960215    
## Joint Effect       20.723665 0.0001201 ***
## 
## 
## Adjusted Pearson Goodness-of-Fit Test:
## ------------------------------------
##   group statistic p-value(g-1)
## 1    20     132.0    6.129e-19
## 2    30     157.1    1.510e-19
## 3    40     178.8    8.634e-20
## 4    50     187.7    4.062e-18
## 
## 
## Elapsed time : 0.2461309

## 
## *---------------------------------*
## *          GARCH Model Fit        *
## *---------------------------------*
## 
## Conditional Variance Dynamics    
## -----------------------------------
## GARCH Model  : sGARCH(1,1)
## Mean Model   : ARFIMA(1,0,0)
## Distribution : norm 
## 
## Optimal Parameters
## ------------------------------------
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.001034    0.000323   3.2024 0.001363
## ar1     0.032518    0.021631   1.5033 0.132759
## omega   0.000018    0.000004   4.2020 0.000026
## alpha1  0.105469    0.015992   6.5952 0.000000
## beta1   0.837324    0.026363  31.7608 0.000000
## 
## Robust Standard Errors:
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.001034    0.000313   3.3035 0.000955
## ar1     0.032518    0.020844   1.5601 0.118735
## omega   0.000018    0.000007   2.5282 0.011463
## alpha1  0.105469    0.033067   3.1896 0.001425
## beta1   0.837324    0.048064  17.4209 0.000000
## 
## LogLikelihood : 6693.437 
## 
## Information Criteria
## ------------------------------------
##                     
## Akaike       -5.3146
## Bayes        -5.3030
## Shibata      -5.3146
## Hannan-Quinn -5.3104
## 
## Weighted Ljung-Box Test on Standardized Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                    0.02465  0.8752
## Lag[2*(p+q)+(p+q)-1][2]   0.56007  0.9483
## Lag[4*(p+q)+(p+q)-1][5]   1.75866  0.7794
## d.o.f=1
## H0 : No serial correlation
## 
## Weighted Ljung-Box Test on Standardized Squared Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                      1.550  0.2131
## Lag[2*(p+q)+(p+q)-1][5]     2.058  0.6047
## Lag[4*(p+q)+(p+q)-1][9]     3.474  0.6789
## d.o.f=2
## 
## Weighted ARCH LM Tests
## ------------------------------------
##             Statistic Shape Scale P-Value
## ARCH Lag[3]   0.06872 0.500 2.000  0.7932
## ARCH Lag[5]   1.27766 1.440 1.667  0.6527
## ARCH Lag[7]   2.21880 2.315 1.543  0.6710
## 
## Nyblom stability test
## ------------------------------------
## Joint Statistic:  0.8989
## Individual Statistics:              
## mu     0.02392
## ar1    0.02142
## omega  0.24816
## alpha1 0.57065
## beta1  0.34992
## 
## Asymptotic Critical Values (10% 5% 1%)
## Joint Statistic:          1.28 1.47 1.88
## Individual Statistic:     0.35 0.47 0.75
## 
## Sign Bias Test
## ------------------------------------
##                    t-value     prob sig
## Sign Bias           0.3415 0.732730    
## Negative Sign Bias  3.0886 0.002033 ***
## Positive Sign Bias  0.5374 0.591062    
## Joint Effect       17.9994 0.000440 ***
## 
## 
## Adjusted Pearson Goodness-of-Fit Test:
## ------------------------------------
##   group statistic p-value(g-1)
## 1    20     77.00    6.080e-09
## 2    30     90.07    3.554e-08
## 3    40    105.79    4.458e-08
## 4    50    114.09    4.159e-07
## 
## 
## Elapsed time : 0.211097</code></pre>
<p>The weighted versions of the Ljung-Box test and their p-values all indicate that the estimated <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model for the conditional mean and variance is adequate for removing serial correlation from the series and squared series.</p>
<hr>
</section>
<section id="applications-to-portfolio-risk-management" class="level2">
<h2 class="anchored" data-anchor-id="applications-to-portfolio-risk-management">Applications to Portfolio Risk Management</h2>
<p>In this section, we apply the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> along with t-Copula residuals to forecast one-step ahead Value-at-Risk at 99% level on the following portfolio consisting of SPXL and BAC with weight <span class="math inline">\(\rho\)</span>:</p>
<p><span class="math display">\[\rho X_{n + 1} + (1-\rho) \tilde X_{n+1}\]</span></p>
<p>where, <span class="math inline">\(\rho = \{0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9\}\)</span></p>
<p>To forecast VaR, we solve the following equation:</p>
<p><span class="math display">\[0.99 = P(\rho X_{n + 1} + (1-\rho) \tilde X_{n+1} \leq x | \mathcal{F})\]</span> <span class="math display">\[0.99 = P(\rho(\mu + \phi X_{n} + \sigma_{n+1}\varepsilon_{n+1}) + (1-\rho) (\tilde\mu + \tilde\phi \tilde X_{n} + \tilde \sigma_{n+1} \tilde \varepsilon_{n+1}) \leq x | \mathcal{F})\]</span></p>
<p>Initially, we forecast one step ahead <span class="math inline">\(\sigma_{n+1}\)</span> and <span class="math inline">\(\tilde \sigma_{n + 1}\)</span> using the <code>ugarchforecast()</code> function. At this point, we have estimated all the unknowns in the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model. In order to solve the above equation numerically, we draw a random sample of size <span class="math inline">\(b = 10000\)</span> from the fitted t-Copula and make transformations to get <span class="math inline">\(\varepsilon_i\)</span> and <span class="math inline">\(\tilde \varepsilon_i\)</span>, <span class="math inline">\(i = 1, \dots, b\)</span> Lastly, we calculate VaR at 99% by calculating the 99th quantile of the following sample</p>
<p><span class="math display">\[\big{\{}\rho(\mu + \phi X_{n} + \sigma_{n+1}\varepsilon_{i}) + (1-\rho) (\tilde\mu + \tilde\phi \tilde X_{n} + \tilde \sigma_{n+1} \tilde \varepsilon_{i})\big{\}}_{i = 1}^b\]</span> In order to see how risk depends on share of portfolio <span class="math inline">\(\rho\)</span>, we conduct the empirical activity for <span class="math inline">\(\rho = 0.1, \dots, 0.9\)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Copula Simulation </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">1</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">2</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>simulate <span class="ot">&lt;-</span> <span class="fu">rCopula</span>(b, <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>, rho, <span class="at">df =</span> df))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>spxl_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">1</span>], <span class="at">df =</span> spxl_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>bac_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">2</span>], <span class="at">df =</span> bac_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe with transformed marginals</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_marginal, bac_marginal)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting sigmas</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>spxl_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(spxl_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>bac_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(bac_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>spxl_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(spxl_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>bac_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(bac_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize parameters</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>s_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>s_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>s_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl[<span class="fu">length</span>(spxl)], b)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>s_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl_sigma, b)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>b_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>b_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>b_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac[<span class="fu">length</span>(bac)], b)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>b_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac_sigma, b)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s_mu <span class="sc">+</span> (s_ar <span class="sc">*</span> s_last) <span class="sc">+</span> (s_sd <span class="sc">*</span> sim[, <span class="dv">1</span>])</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>ba <span class="ot">&lt;-</span> b_mu <span class="sc">+</span> (b_ar <span class="sc">*</span> b_last) <span class="sc">+</span> (b_sd <span class="sc">*</span> sim[, <span class="dv">2</span>])</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>pred_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(s, ba)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>rhos <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>var_sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span>  <span class="fl">0.01</span> <span class="co"># 99th percentile</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>portfolio_value <span class="ot">&lt;-</span> <span class="dv">1000000</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> rhos){</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  s_rho <span class="ot">&lt;-</span> s <span class="sc">*</span> <span class="fu">rep</span>(i, b)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  b_rho <span class="ot">&lt;-</span> ba <span class="sc">*</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">-</span> i, b)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  sample <span class="ot">&lt;-</span>  s_rho <span class="sc">+</span> b_rho</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(sample, alpha))</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  VaR <span class="ot">&lt;-</span> <span class="sc">-</span> portfolio_value <span class="sc">*</span> q</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  var_sample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(var_sample, VaR)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VaR ($)"</span>)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"p = 0.1"</span>, <span class="st">"p = 0.2"</span>, <span class="st">"p = 0.3"</span>, <span class="st">"p = 0.4"</span>, </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.5"</span>, <span class="st">"p = 0.6"</span>, <span class="st">"p = 0.7"</span>, <span class="st">"p = 0.8"</span>, </span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.9"</span>)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>var_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##           VaR ($)
## p = 0.1  60047.89
## p = 0.2  67715.91
## p = 0.3  76620.78
## p = 0.4  87012.86
## p = 0.5  95316.61
## p = 0.6 106135.22
## p = 0.7 116638.79
## p = 0.8 128612.34
## p = 0.9 139554.01</code></pre>
<p>The table reports the Value-at-Risk at 99% level for a portfolio value of $1,000,000. It is evident from the table that as SPXL’s proportion in the portfolio increases (<span class="math inline">\(\rho\)</span>), the Value-at-Risk increases. These results are in line with expectations as Direxion Daily S&amp;P 500 Bull 3X Shares is a 300% leveraged instrument based on the S&amp;P 500 index. When <span class="math inline">\(\rho = 0.2\)</span>, there is a 1% percent chance that the loss would be greater than 6.7715911^{4} the next day on a $1,000,000 investment. Similarly, When <span class="math inline">\(\rho = 0.9\)</span>, there is a 1% percent chance that the loss would be greater than 1.3955401^{5} the next day on a $1,000,000 investment.</p>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<p>R code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing Packages</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fGarch)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sn)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(copula)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ks)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rugarch)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning Date</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2012-11-09"</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-11-10"</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>spxl_df <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"SPXL"</span>, <span class="at">from =</span> start, <span class="at">to =</span> end, <span class="at">src =</span> <span class="st">"yahoo"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">auto.assign =</span> F)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>bac_df <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"BAC"</span>, <span class="at">from =</span> start, <span class="at">to =</span> end, <span class="at">src =</span> <span class="st">"yahoo"</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">auto.assign =</span> F)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>daily_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_df<span class="sc">$</span>SPXL.Adjusted, bac_df<span class="sc">$</span>BAC.Adjusted)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SPXL"</span>, <span class="st">"BAC"</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>daily_df<span class="sc">$</span>SPXL_r <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(daily_df<span class="sc">$</span>SPXL))</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>daily_df<span class="sc">$</span>BAC_r <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(daily_df<span class="sc">$</span>BAC))</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>daily_df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(daily_df)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(<span class="fu">describe</span>(daily_df, <span class="at">ranges =</span> F), <span class="at">summary =</span> F, <span class="at">type =</span> <span class="st">"html"</span>, <span class="at">title =</span> <span class="st">"Table 1. Summary Statistics"</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(spxl_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> SPXL.Adjusted))<span class="sc">+</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span> </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SPXL Daily Price"</span>) <span class="sc">+</span>   </span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Price($)"</span>) <span class="sc">+</span> </span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bac_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> BAC.Adjusted))<span class="sc">+</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange2"</span>) <span class="sc">+</span> </span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"BAC Daily Price"</span>) <span class="sc">+</span>   </span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Price($)"</span>) <span class="sc">+</span> </span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">/</span> plot2</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting log returns</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>plot_spxl_r <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> SPXL_r))<span class="sc">+</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span> </span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SPXL Log Returns"</span>) <span class="sc">+</span>   </span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>plot_bac_r <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> BAC_r))<span class="sc">+</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange2"</span>) <span class="sc">+</span> </span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"BAC Log Returns"</span>) <span class="sc">+</span>   </span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>plot_spxl_r <span class="sc">/</span> plot_bac_r</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(daily_df<span class="sc">$</span>SPXL_r)</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(daily_df<span class="sc">$</span>BAC_r)</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF plots</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>ggacf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">type=</span><span class="st">"correlation"</span>, <span class="at">xlab=</span><span class="st">"Lag"</span>, <span class="at">ylab=</span><span class="cn">NULL</span>,</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim=</span><span class="cn">NULL</span>, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">ci.col=</span><span class="st">"blue"</span>, <span class="at">lag.max=</span><span class="cn">NULL</span>) {</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(x)</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>  x.acf <span class="ot">&lt;-</span> <span class="fu">acf</span>(x, <span class="at">plot=</span>F, <span class="at">lag.max=</span>lag.max, <span class="at">type=</span>type)</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  ci.line <span class="ot">&lt;-</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">-</span> ci) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(x.acf<span class="sc">$</span>n.used)</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>  d.acf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lag=</span>x.acf<span class="sc">$</span>lag, <span class="at">acf=</span>x.acf<span class="sc">$</span>acf)</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d.acf, <span class="fu">aes</span>(<span class="at">x=</span>lag, <span class="at">y=</span>acf)) <span class="sc">+</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend=</span>lag, <span class="at">yend=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>ci.line, <span class="at">color=</span>ci.col, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="sc">-</span>ci.line, <span class="at">color=</span>ci.col, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Lag"</span>) <span class="sc">+</span></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">ifelse</span>(<span class="fu">is.null</span>(main), <span class="st">""</span>, main)) <span class="sc">+</span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(ylab))</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">"partial"</span>, <span class="st">"PACF"</span>, <span class="st">"ACF"</span>))</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(ylab)</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>spxl_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>SPXL_r, <span class="at">main =</span> <span class="st">"SPXL"</span>)</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>spxl_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>SPXL_r <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"SPXL Squared"</span>)</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>bac_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>BAC_r, <span class="at">main =</span> <span class="st">"BAC"</span>)</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>bac_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>BAC_r <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"BAC Squared"</span>)</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>(spxl_acf <span class="sc">+</span> spxl_acf2) <span class="sc">/</span> (bac_acf <span class="sc">+</span> bac_acf2)</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>spxl <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>SPXL_r)</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>bac <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>BAC_r)</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting an AR(1) + GARCH(1,1) Model</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>spxl_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>spxl_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(spxl_spec, <span class="at">data =</span> spxl)</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>bac_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>bac_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(bac_spec, <span class="at">data =</span> bac)</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized Residuals</span></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>spxl_res <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">residuals</span>(spxl_fit, <span class="at">standardize =</span> T))</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>bac_res <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">residuals</span>(bac_fit, <span class="at">standardize =</span> T))</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting t-distribution</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>spxl_res_t <span class="ot">&lt;-</span> <span class="fu">fitdistr</span>(spxl_res, <span class="st">"t"</span>)</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>bac_res_t <span class="ot">&lt;-</span> <span class="fu">fitdistr</span>(bac_res, <span class="st">"t"</span>)</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting t-density plots</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(spxl_res)</span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">:</span>n)<span class="sc">/</span>(n<span class="sc">+</span><span class="dv">1</span>), <span class="at">df =</span> <span class="dv">5</span>)</span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">:</span>n)<span class="sc">/</span>(n<span class="sc">+</span><span class="dv">1</span>), <span class="at">df =</span> <span class="dv">5</span>)</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="fu">sort</span>(spxl_res), x1, <span class="at">xlab=</span><span class="st">"Standardized Residuals"</span>,</span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">"t-quantiles"</span>,</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"SPXL Residual t-plot, DF = 5"</span>)</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="fu">sort</span>(bac_res), x2, <span class="at">xlab=</span><span class="st">"Standardized Residuals"</span>,</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">"tquantiles"</span>,</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"BAC Residual t-plot, DF = 5"</span>)</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform residues into uniform distribution</span></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>spxl_uniform <span class="ot">&lt;-</span> <span class="fu">pt</span>(spxl_res, <span class="at">df =</span> spxl_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>bac_uniform <span class="ot">&lt;-</span> <span class="fu">pt</span>(bac_res, <span class="at">df =</span> bac_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>U_hat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_uniform, bac_uniform)</span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(U_hat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SPXL_U"</span>, <span class="st">"BAC_U"</span>)</span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">cor.test</span>(spxl_uniform, bac_uniform, </span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method=</span><span class="st">"kendall"</span>)<span class="sc">$</span>estimate)</span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> <span class="fu">sin</span>(tau <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit t-Copula</span></span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>Ct <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start =</span> <span class="fu">c</span>(omega, <span class="dv">10</span>))</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-Likelihood</span></span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>log_lik_t <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Ct<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>                          <span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>aic_t <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Ct<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(log_lik_t))</span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>aic_t</span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Gaussian Copula</span></span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>Cgauss <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat, </span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start=</span><span class="fu">c</span>(omega))</span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>log_lik_gauss <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cgauss<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>                              <span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>aic_gauss <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cgauss<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_gauss))</span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a>aic_gauss</span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Gumbel Copula</span></span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a>C_gumbel <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span>U_hat,</span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>log_lik_gumbel <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_gumbel<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a>                               <span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>aic_gumbel <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_gumbel<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_gumbel))</span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>aic_gumbel</span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Clayton Copula</span></span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>C_clayton <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>log_lik_clayton <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_clayton<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a>                                <span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>aic_clayton <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_clayton<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_clayton))</span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a>aic_clayton</span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Frank Copula</span></span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>Cfrank <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="dv">1</span>, <span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>log_lik_frank <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cfrank<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>                              <span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>aic_frank <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cfrank<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_frank))</span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a>aic_frank</span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a>spxl_res_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(spxl_res, <span class="at">main =</span> <span class="st">"SPXL Std. Residuals"</span>)</span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>spxl_res_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(spxl_res <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Squared SPXL Std. Residuals"</span>)</span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>bac_res_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(bac_res, <span class="at">main =</span> <span class="st">"BAC Std. Residuals"</span>)</span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a>bac_res_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(bac_res <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Squared BAC Std. Residuals"</span>)</span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a>(spxl_res_acf <span class="sc">+</span> spxl_res_acf2) <span class="sc">/</span> (bac_res_acf <span class="sc">+</span> bac_res_acf2)</span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(spxl_fit)</span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(bac_fit)</span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Copula Simulation </span></span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">1</span>]</span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">2</span>]</span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a>simulate <span class="ot">&lt;-</span> <span class="fu">rCopula</span>(b, <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>, rho, <span class="at">df =</span> df))</span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>spxl_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">1</span>], <span class="at">df =</span> spxl_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>bac_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">2</span>], <span class="at">df =</span> bac_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe with transformed marginals</span></span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_marginal, bac_marginal)</span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting sigmas</span></span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>spxl_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(spxl_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a>bac_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(bac_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>spxl_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(spxl_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>bac_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(bac_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize parameters</span></span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a>s_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>s_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a>s_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl[<span class="fu">length</span>(spxl)], b)</span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>s_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl_sigma, b)</span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a>b_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>b_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>b_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac[<span class="fu">length</span>(bac)], b)</span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a>b_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac_sigma, b)</span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s_mu <span class="sc">+</span> (s_ar <span class="sc">*</span> s_last) <span class="sc">+</span> (s_sd <span class="sc">*</span> sim[, <span class="dv">1</span>])</span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a>ba <span class="ot">&lt;-</span> b_mu <span class="sc">+</span> (b_ar <span class="sc">*</span> b_last) <span class="sc">+</span> (b_sd <span class="sc">*</span> sim[, <span class="dv">2</span>])</span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>pred_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(s, ba)</span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a>rhos <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>var_sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span>  <span class="fl">0.01</span> <span class="co"># 99th percentile</span></span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a>portfolio_value <span class="ot">&lt;-</span> <span class="dv">1000000</span></span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> rhos){</span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-264"><a href="#cb16-264" aria-hidden="true" tabindex="-1"></a>  s_rho <span class="ot">&lt;-</span> s <span class="sc">*</span> <span class="fu">rep</span>(i, b)</span>
<span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>  b_rho <span class="ot">&lt;-</span> ba <span class="sc">*</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">-</span> i, b)</span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a>  sample <span class="ot">&lt;-</span>  s_rho <span class="sc">+</span> b_rho</span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(sample, alpha))</span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a>  VaR <span class="ot">&lt;-</span> <span class="sc">-</span> portfolio_value <span class="sc">*</span> q</span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a>  var_sample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(var_sample, VaR)</span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VaR ($)"</span>)</span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"p = 0.1"</span>, <span class="st">"p = 0.2"</span>, <span class="st">"p = 0.3"</span>, <span class="st">"p = 0.4"</span>, </span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.5"</span>, <span class="st">"p = 0.6"</span>, <span class="st">"p = 0.7"</span>, <span class="st">"p = 0.8"</span>, </span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.9"</span>)</span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a>var_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>