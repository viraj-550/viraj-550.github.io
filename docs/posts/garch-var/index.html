<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Viraj Chordiya">
<meta name="dcterms.date" content="2022-11-30">

<title>Viraj R. Chordiya - Financial Econometrics Final Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Viraj R. Chordiya - Financial Econometrics Final Project">
<meta property="og:description" content="In todays volatile world, portfolio management is crucial as it helps reduce the investment strategy risk to the extent that cannot be ignored.">
<meta property="og:site-name" content="Viraj R. Chordiya">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Viraj R. Chordiya</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Viraj_Chordiya_Resume.pdf">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/viraj-550"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/virajchordiya/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Financial Econometrics Final Project</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Financial Econometrics</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Viraj Chordiya </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 30, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In todays volatile world, portfolio management is crucial as it helps reduce the investment strategy risk to the extent that cannot be ignored. The goal of a portfolio manager is to reduce risks and maximize returns for their clients. The aim of this project is to analyse the Direxion Daily S&amp;P 500 Bull 3X Shares (SPXL) ETF and Bank of America Corp (NYSE: BAC) stock and study an optimal portfolio to forecast Value-at-Risk. Direxion Daily S&amp;P 500 Bull 3X Shares is a 300% leveraged ETF derived from the S&amp;P 500 index and Bank of America is an evergreen stock generating steady returns. An optimum portfolio mix of these two financial assets can reduce VaR and provide handsome returns. We collect previous 10 year daily OHLC data for both the instruments from Yahoo Finance using <code>quantmod::getSymbols()</code> in R.</p>
<p>To this end, we perform the following analyses:</p>
<ol type="1">
<li>Explore the data to check for time dependence and volatility clustering.</li>
<li>Build a time series model, specifically, <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> to model each product’s log returns.</li>
<li>Fit t-distributions to the standardized errors of both models. In order to study the dependence structure of both the residues, we fit several copulas like t - Copula, Gaussian copula, Gumbel Copula, Clayton and Frank copulas and choose the best one by minimizing AIC.</li>
<li>We conduct a residual analysis on the standardized residues of the model to check for any serial correlation. Using autocorrelation plots and weighted versions of Ljung-Box test, we conclude that the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model is a good fit for the data.</li>
<li>Lastly, we utilize numerical methods to conduct Value-at-Risk forecasting of a portfolio mix of SPXL and BAC. We find that VaR increases as SPXL’s share in the portfolio increases.</li>
</ol>
<hr>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>We collect ten years daily OHLC data of Direxion Daily S&amp;P 500 Bull 3X Shares (SPXL) and Bank of America Corp (NYSE: BAC). SPXL is a three times leveraged ETF mirroring the S&amp;P 500 index. Hence, it provides a 300% of the S&amp;P 500 index’s daily return. The data is collected from Yahoo finance for period 2012/11 - 2022/11 using the <code>getSymbol()</code> function from the <code>quantmod</code> library. The table represents the summary statistics of daily adjusted closing stock price, and log returns of both the instruments.</p>

<table style="text-align:center">
<caption>
<strong>Table 1. Summary Statistics</strong>
</caption>
<tbody><tr>
<td colspan="8" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
vars
</td>
<td>
n
</td>
<td>
mean
</td>
<td>
sd
</td>
<td>
skew
</td>
<td>
kurtosis
</td>
<td>
se
</td>
</tr>
<tr>
<td colspan="8" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
SPXL
</td>
<td>
1
</td>
<td>
2,517
</td>
<td>
42.899
</td>
<td>
31.554
</td>
<td>
1.240
</td>
<td>
0.854
</td>
<td>
0.629
</td>
</tr>
<tr>
<td style="text-align:left">
BAC
</td>
<td>
2
</td>
<td>
2,517
</td>
<td>
22.488
</td>
<td>
9.675
</td>
<td>
0.591
</td>
<td>
-0.556
</td>
<td>
0.193
</td>
</tr>
<tr>
<td style="text-align:left">
SPXL_r
</td>
<td>
3
</td>
<td>
2,517
</td>
<td>
0.001
</td>
<td>
0.033
</td>
<td>
-1.525
</td>
<td>
20.383
</td>
<td>
0.001
</td>
</tr>
<tr>
<td style="text-align:left">
BAC_r
</td>
<td>
4
</td>
<td>
2,517
</td>
<td>
0.001
</td>
<td>
0.019
</td>
<td>
-0.070
</td>
<td>
9.849
</td>
<td>
0.0004
</td>
</tr>
<tr>
<td colspan="8" style="border-bottom: 1px solid black">
</td>
</tr>

</tbody></table>
<p>There are a total of 2517 observations in total. Prices and log returns of both the financial instruments are asymmetric. SPXL daily prices are extremely skewed to the right, while SPXL returns are extremely skewed to the left. Moreover, BAC daily prices are slightly skewed to the right while the returns are slightly skewed to the left. The excess kurtosis for the log returns of both assets show that returns are not normally distributed.</p>
<section id="time-series-graphs-and-distribution-plots" class="level3">
<h3 class="anchored" data-anchor-id="time-series-graphs-and-distribution-plots">Time series graphs and distribution plots</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>Firstly, we check for weak stationarity by investigating the time series plots of log returns of both the financial instruments. Next, we conduct the Augmented Dickey Fuller (ADF) test to check for the presence of unit root.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  daily_df$SPXL_r
Dickey-Fuller = -13.314, Lag order = 13, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  daily_df$BAC_r
Dickey-Fuller = -12.962, Lag order = 13, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>Upon visual inspection, it looks like both the log returns are stationary. Moreover, from the ADF test, we fail to reject the null hypothesis of non-stationarity at 1% confidence.</p>
<p>In order to look for time dependency and volatility clustering of log returns of SPLX and BAC, From the graphs, it is evident that both series display time varying volatility. Moreover, volatility clusters together. For better analysis, we need to model the nonconstant volatility.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/ggplot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the log return graphs, it is evident that both series display time varying volatility. Moreover, ACF plots of squared series of both stocks show significant serial correlation. For better analysis, we need to model time dependence and non-constant volatility.</p>
<hr>
</section>
<section id="time-series-model" class="level2">
<h2 class="anchored" data-anchor-id="time-series-model">Time Series Model</h2>
<section id="ar1-garch11-model" class="level3">
<h3 class="anchored" data-anchor-id="ar1-garch11-model">AR(1)-GARCH(1,1) Model</h3>
<p>In order to model autocorelation and volatility clustering, we combine an AR(1) model that has a nonconstant conditional mean but a constant conditional variance with a GARCH(1,1) model that has conditional mean and the variance of data depends on the past. Additionally, in a GARCH model, conditional standard deviation exhibits more persistent periods of low and high volatility.</p>
<p>The <span class="math inline">\(AR(1) - GARCH(1,1)\)</span> is model is as follows:</p>
<p><span class="math display">\[ X_t = \mu + \phi X_{t-1} + e_t, \quad e_t =  \sigma_{t}\varepsilon_{t}, \quad \sigma^2_t = \omega + \alpha e^2_{t-1} + \beta \sigma^2_{t-1} \]</span> <span class="math display">\[ \tilde X_t = \tilde \mu + \tilde \phi \tilde X_{t-1} + \tilde e_t, \quad \tilde e_t =  \tilde \sigma_{t}\tilde \varepsilon_{t}, \quad \tilde \sigma^2_t = \tilde \omega + \tilde \alpha \tilde e^2_{t-1} + \tilde \beta \tilde \sigma^2_{t-1} \]</span> where, <span class="math inline">\(X_t\)</span> is the daily log returns of SPXL and <span class="math inline">\(\tilde X_t\)</span> is the daily log returns of BAC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>spxl <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>SPXL_r)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>bac <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>BAC_r)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting an AR(1) + GARCH(1,1) Model</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>spxl_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>spxl_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(spxl_spec, <span class="at">data =</span> spxl)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>bac_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>bac_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(bac_spec, <span class="at">data =</span> bac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="residual-copula-modelling" class="level3">
<h3 class="anchored" data-anchor-id="residual-copula-modelling">Residual Copula Modelling</h3>
<p>In order to work with a portfolio of Direxion Daily S&amp;P 500 Bull 3X Shares (SPXL) and Bank of America Corp (BAC), we need to model both the series as a copula to extract the dependence structure between the two financial instruments. In the project, we particulary study the dependent structure of the standardized residuals of an <span class="math inline">\(AR(1) - GARCH(1,1)\)</span> model fitted to both the series.</p>
<p>First, we fit a Student t distribution to both <span class="math inline">\(\varepsilon_t\)</span> and <span class="math inline">\(\tilde \varepsilon_t\)</span> using the <code>fitdistr()</code> function from the <code>MASS</code> library.</p>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A t-distribution with df = 5 fits well to the SPXL and BAC residuals. The qqplot for both the instruments is a straight line except for a few outliers. Given that the total number of observations (n = 2517) is high enough, the outliers are a small fraction of the sample.</p>
<p>Second, we transform the residuals into marginal t - distributions and fit t-copula, Gaussian copula, Gumbel Copula, Clayton and Frank copulas. We select the best fit copula by minimizing AIC. We select t-copula as it minimizes AIC.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit t-Copula</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Ct <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start =</span> <span class="fu">c</span>(omega, <span class="dv">10</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-Likelihood</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>log_lik_t <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Ct<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>aic_t <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Ct<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(log_lik_t))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>aic_t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1516.139</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gaussian Copula</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Cgauss <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start=</span><span class="fu">c</span>(omega))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>log_lik_gauss <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cgauss<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>aic_gauss <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cgauss<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_gauss))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>aic_gauss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1411.647</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gumbel Copula</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>C_gumbel <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span>U_hat,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>log_lik_gumbel <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_gumbel<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>aic_gumbel <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_gumbel<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_gumbel))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>aic_gumbel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1388.313</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clayton Copula</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>C_clayton <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>log_lik_clayton <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_clayton<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>aic_clayton <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_clayton<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_clayton))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>aic_clayton</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1213.367</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Frank Copula</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>Cfrank <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="dv">1</span>, <span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>log_lik_frank <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cfrank<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>aic_frank <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cfrank<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_frank))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>aic_frank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1395.35</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="residual-analysis" class="level2">
<h2 class="anchored" data-anchor-id="residual-analysis">Residual Analysis</h2>
<p>We conduct a residual analysis on the standardized residuals <span class="math inline">\(\varepsilon_t\)</span> and <span class="math inline">\(\tilde \varepsilon\)</span> to check the fit of the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model.</p>
<p>First, we inspect the standardized residuals and squared standardized residuals for autocorrelation. The figure below plots the <code>acf()</code> function for the four series.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The AR(1) + GARCH(1,1) model fits very well to SPXL and BAC. The standardized residuals and the squared standardized residuals of both the models show no significant serial correlation at 95% confidence.</p>
<p>Next we look at the following box tests to check autocorrelation</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
*---------------------------------*
*          GARCH Model Fit        *
*---------------------------------*

Conditional Variance Dynamics   
-----------------------------------
GARCH Model : sGARCH(1,1)
Mean Model  : ARFIMA(1,0,0)
Distribution    : norm 

Optimal Parameters
------------------------------------
        Estimate  Std. Error  t value Pr(&gt;|t|)
mu      0.002425    0.000386   6.2772 0.000000
ar1    -0.057589    0.022519  -2.5574 0.010546
omega   0.000039    0.000005   7.2771 0.000000
alpha1  0.234802    0.023531   9.9784 0.000000
beta1   0.735776    0.021292  34.5560 0.000000

Robust Standard Errors:
        Estimate  Std. Error  t value Pr(&gt;|t|)
mu      0.002425    0.000393   6.1642 0.000000
ar1    -0.057589    0.020538  -2.8040 0.005047
omega   0.000039    0.000008   4.7664 0.000002
alpha1  0.234802    0.035228   6.6651 0.000000
beta1   0.735776    0.030381  24.2180 0.000000

LogLikelihood : 5725.413 

Information Criteria
------------------------------------
                    
Akaike       -4.5454
Bayes        -4.5338
Shibata      -4.5454
Hannan-Quinn -4.5412

Weighted Ljung-Box Test on Standardized Residuals
------------------------------------
                        statistic p-value
Lag[1]                      2.049  0.1523
Lag[2*(p+q)+(p+q)-1][2]     2.124  0.1746
Lag[4*(p+q)+(p+q)-1][5]     2.964  0.4404
d.o.f=1
H0 : No serial correlation

Weighted Ljung-Box Test on Standardized Squared Residuals
------------------------------------
                        statistic p-value
Lag[1]                    0.00449  0.9466
Lag[2*(p+q)+(p+q)-1][5]   0.75536  0.9121
Lag[4*(p+q)+(p+q)-1][9]   2.39145  0.8535
d.o.f=2

Weighted ARCH LM Tests
------------------------------------
            Statistic Shape Scale P-Value
ARCH Lag[3] 0.0006994 0.500 2.000  0.9789
ARCH Lag[5] 1.8924772 1.440 1.667  0.4955
ARCH Lag[7] 2.9168559 2.315 1.543  0.5294

Nyblom stability test
------------------------------------
Joint Statistic:  1.4922
Individual Statistics:              
mu     0.06813
ar1    0.03829
omega  0.25543
alpha1 0.74932
beta1  0.80370

Asymptotic Critical Values (10% 5% 1%)
Joint Statistic:         1.28 1.47 1.88
Individual Statistic:    0.35 0.47 0.75

Sign Bias Test
------------------------------------
                     t-value      prob sig
Sign Bias           3.751292 0.0001799 ***
Negative Sign Bias  0.946948 0.3437561    
Positive Sign Bias  0.004954 0.9960476    
Joint Effect       20.723582 0.0001201 ***


Adjusted Pearson Goodness-of-Fit Test:
------------------------------------
  group statistic p-value(g-1)
1    20     132.0    6.129e-19
2    30     157.1    1.510e-19
3    40     178.8    8.634e-20
4    50     187.7    4.062e-18


Elapsed time : 0.3075819 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
*---------------------------------*
*          GARCH Model Fit        *
*---------------------------------*

Conditional Variance Dynamics   
-----------------------------------
GARCH Model : sGARCH(1,1)
Mean Model  : ARFIMA(1,0,0)
Distribution    : norm 

Optimal Parameters
------------------------------------
        Estimate  Std. Error  t value Pr(&gt;|t|)
mu      0.001034    0.000323   3.2023 0.001363
ar1     0.032520    0.021631   1.5034 0.132731
omega   0.000018    0.000004   4.2020 0.000026
alpha1  0.105469    0.015992   6.5953 0.000000
beta1   0.837323    0.026364  31.7607 0.000000

Robust Standard Errors:
        Estimate  Std. Error  t value Pr(&gt;|t|)
mu      0.001034    0.000313   3.3035 0.000955
ar1     0.032520    0.020844   1.5602 0.118709
omega   0.000018    0.000007   2.5283 0.011462
alpha1  0.105469    0.033066   3.1896 0.001425
beta1   0.837323    0.048064  17.4210 0.000000

LogLikelihood : 6693.438 

Information Criteria
------------------------------------
                    
Akaike       -5.3146
Bayes        -5.3030
Shibata      -5.3146
Hannan-Quinn -5.3104

Weighted Ljung-Box Test on Standardized Residuals
------------------------------------
                        statistic p-value
Lag[1]                    0.02462  0.8753
Lag[2*(p+q)+(p+q)-1][2]   0.56004  0.9483
Lag[4*(p+q)+(p+q)-1][5]   1.75862  0.7794
d.o.f=1
H0 : No serial correlation

Weighted Ljung-Box Test on Standardized Squared Residuals
------------------------------------
                        statistic p-value
Lag[1]                      1.550  0.2131
Lag[2*(p+q)+(p+q)-1][5]     2.058  0.6047
Lag[4*(p+q)+(p+q)-1][9]     3.474  0.6789
d.o.f=2

Weighted ARCH LM Tests
------------------------------------
            Statistic Shape Scale P-Value
ARCH Lag[3]   0.06871 0.500 2.000  0.7932
ARCH Lag[5]   1.27764 1.440 1.667  0.6527
ARCH Lag[7]   2.21876 2.315 1.543  0.6710

Nyblom stability test
------------------------------------
Joint Statistic:  0.8988
Individual Statistics:              
mu     0.02392
ar1    0.02143
omega  0.24815
alpha1 0.57061
beta1  0.34991

Asymptotic Critical Values (10% 5% 1%)
Joint Statistic:         1.28 1.47 1.88
Individual Statistic:    0.35 0.47 0.75

Sign Bias Test
------------------------------------
                   t-value      prob sig
Sign Bias           0.3416 0.7327015    
Negative Sign Bias  3.0886 0.0020333 ***
Positive Sign Bias  0.5373 0.5910849    
Joint Effect       17.9995 0.0004399 ***


Adjusted Pearson Goodness-of-Fit Test:
------------------------------------
  group statistic p-value(g-1)
1    20     77.00    6.080e-09
2    30     89.57    4.243e-08
3    40    105.92    4.275e-08
4    50    114.09    4.159e-07


Elapsed time : 0.438179 </code></pre>
</div>
</div>
<p>The weighted versions of the Ljung-Box test and their p-values all indicate that the estimated <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model for the conditional mean and variance is adequate for removing serial correlation from the series and squared series.</p>
<hr>
</section>
<section id="applications-to-portfolio-risk-management" class="level2">
<h2 class="anchored" data-anchor-id="applications-to-portfolio-risk-management">Applications to Portfolio Risk Management</h2>
<p>In this section, we apply the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> along with t-Copula residuals to forecast one-step ahead Value-at-Risk at 99% level on the following portfolio consisting of SPXL and BAC with weight <span class="math inline">\(\rho\)</span>:</p>
<p><span class="math display">\[\rho X_{n + 1} + (1-\rho) \tilde X_{n+1}\]</span></p>
<p>where, <span class="math inline">\(\rho = \{0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9\}\)</span></p>
<p>To forecast VaR, we solve the following equation:</p>
<p><span class="math display">\[0.99 = P(\rho X_{n + 1} + (1-\rho) \tilde X_{n+1} \leq x | \mathcal{F})\]</span> <span class="math display">\[0.99 = P(\rho(\mu + \phi X_{n} + \sigma_{n+1}\varepsilon_{n+1}) + (1-\rho) (\tilde\mu + \tilde\phi \tilde X_{n} + \tilde \sigma_{n+1} \tilde \varepsilon_{n+1}) \leq x | \mathcal{F})\]</span></p>
<p>Initially, we forecast one step ahead <span class="math inline">\(\sigma_{n+1}\)</span> and <span class="math inline">\(\tilde \sigma_{n + 1}\)</span> using the <code>ugarchforecast()</code> function. At this point, we have estimated all the unknowns in the <span class="math inline">\(AR(1) + GARCH(1,1)\)</span> model. In order to solve the above equation numerically, we draw a random sample of size <span class="math inline">\(b = 10000\)</span> from the fitted t-Copula and make transformations to get <span class="math inline">\(\varepsilon_i\)</span> and <span class="math inline">\(\tilde \varepsilon_i\)</span>, <span class="math inline">\(i = 1, \dots, b\)</span> Lastly, we calculate VaR at 99% by calculating the 99th quantile of the following sample</p>
<p><span class="math display">\[\big{\{}\rho(\mu + \phi X_{n} + \sigma_{n+1}\varepsilon_{i}) + (1-\rho) (\tilde\mu + \tilde\phi \tilde X_{n} + \tilde \sigma_{n+1} \tilde \varepsilon_{i})\big{\}}_{i = 1}^b\]</span> In order to see how risk depends on share of portfolio <span class="math inline">\(\rho\)</span>, we conduct the empirical activity for <span class="math inline">\(\rho = 0.1, \dots, 0.9\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Copula Simulation </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">1</span>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">2</span>]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>simulate <span class="ot">&lt;-</span> <span class="fu">rCopula</span>(b, <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>, rho, <span class="at">df =</span> df))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>spxl_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">1</span>], <span class="at">df =</span> spxl_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>bac_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">2</span>], <span class="at">df =</span> bac_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe with transformed marginals</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_marginal, bac_marginal)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting sigmas</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>spxl_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(spxl_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>bac_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(bac_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>spxl_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(spxl_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>bac_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(bac_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize parameters</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>s_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>s_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>s_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl[<span class="fu">length</span>(spxl)], b)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>s_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl_sigma, b)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>b_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>b_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>b_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac[<span class="fu">length</span>(bac)], b)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>b_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac_sigma, b)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s_mu <span class="sc">+</span> (s_ar <span class="sc">*</span> s_last) <span class="sc">+</span> (s_sd <span class="sc">*</span> sim[, <span class="dv">1</span>])</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>ba <span class="ot">&lt;-</span> b_mu <span class="sc">+</span> (b_ar <span class="sc">*</span> b_last) <span class="sc">+</span> (b_sd <span class="sc">*</span> sim[, <span class="dv">2</span>])</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>pred_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(s, ba)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>rhos <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>var_sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span>  <span class="fl">0.01</span> <span class="co"># 99th percentile</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>portfolio_value <span class="ot">&lt;-</span> <span class="dv">1000000</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> rhos){</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  s_rho <span class="ot">&lt;-</span> s <span class="sc">*</span> <span class="fu">rep</span>(i, b)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  b_rho <span class="ot">&lt;-</span> ba <span class="sc">*</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">-</span> i, b)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>  sample <span class="ot">&lt;-</span>  s_rho <span class="sc">+</span> b_rho</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(sample, alpha))</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  VaR <span class="ot">&lt;-</span> <span class="sc">-</span> portfolio_value <span class="sc">*</span> q</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  var_sample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(var_sample, VaR)</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VaR ($)"</span>)</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"p = 0.1"</span>, <span class="st">"p = 0.2"</span>, <span class="st">"p = 0.3"</span>, <span class="st">"p = 0.4"</span>, </span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.5"</span>, <span class="st">"p = 0.6"</span>, <span class="st">"p = 0.7"</span>, <span class="st">"p = 0.8"</span>, </span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.9"</span>)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>var_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          VaR ($)
p = 0.1  56868.64
p = 0.2  64760.15
p = 0.3  71810.30
p = 0.4  80322.54
p = 0.5  89308.00
p = 0.6  98992.82
p = 0.7 108932.23
p = 0.8 118802.90
p = 0.9 128930.28</code></pre>
</div>
</div>
<p>The table reports the Value-at-Risk at 99% level for a portfolio value of $1,000,000. It is evident from the table that as SPXL’s proportion in the portfolio increases (<span class="math inline">\(\rho\)</span>), the Value-at-Risk increases. These results are in line with expectations as Direxion Daily S&amp;P 500 Bull 3X Shares is a 300% leveraged instrument based on the S&amp;P 500 index. When <span class="math inline">\(\rho = 0.2\)</span>, there is a 1% percent chance that the loss would be greater than 6.4760151^{4} the next day on a $1,000,000 investment. Similarly, When <span class="math inline">\(\rho = 0.9\)</span>, there is a 1% percent chance that the loss would be greater than 1.2893028^{5} the next day on a $1,000,000 investment.</p>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<p>R code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing Packages</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fGarch)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sn)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(copula)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ks)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rugarch)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning Date</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2012-11-09"</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-11-10"</span>)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>spxl_df <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"SPXL"</span>, <span class="at">from =</span> start, <span class="at">to =</span> end, <span class="at">src =</span> <span class="st">"yahoo"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">auto.assign =</span> F)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>bac_df <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"BAC"</span>, <span class="at">from =</span> start, <span class="at">to =</span> end, <span class="at">src =</span> <span class="st">"yahoo"</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">auto.assign =</span> F)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>daily_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_df<span class="sc">$</span>SPXL.Adjusted, bac_df<span class="sc">$</span>BAC.Adjusted)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SPXL"</span>, <span class="st">"BAC"</span>)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>daily_df<span class="sc">$</span>SPXL_r <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(daily_df<span class="sc">$</span>SPXL))</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>daily_df<span class="sc">$</span>BAC_r <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(daily_df<span class="sc">$</span>BAC))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>daily_df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(daily_df)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(<span class="fu">describe</span>(daily_df, <span class="at">ranges =</span> F), <span class="at">summary =</span> F, <span class="at">type =</span> <span class="st">"html"</span>, <span class="at">title =</span> <span class="st">"Table 1. Summary Statistics"</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(spxl_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> SPXL.Adjusted))<span class="sc">+</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span> </span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SPXL Daily Price"</span>) <span class="sc">+</span>   </span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Price($)"</span>) <span class="sc">+</span> </span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bac_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> BAC.Adjusted))<span class="sc">+</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange2"</span>) <span class="sc">+</span> </span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"BAC Daily Price"</span>) <span class="sc">+</span>   </span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Price($)"</span>) <span class="sc">+</span> </span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">/</span> plot2</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting log returns</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>plot_spxl_r <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> SPXL_r))<span class="sc">+</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span> </span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SPXL Log Returns"</span>) <span class="sc">+</span>   </span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>plot_bac_r <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_df, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> BAC_r))<span class="sc">+</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange2"</span>) <span class="sc">+</span> </span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"BAC Log Returns"</span>) <span class="sc">+</span>   </span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> </span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%y-%m"</span>, <span class="at">date_breaks =</span> <span class="st">"1 year"</span>)</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>plot_spxl_r <span class="sc">/</span> plot_bac_r</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(daily_df<span class="sc">$</span>SPXL_r)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(daily_df<span class="sc">$</span>BAC_r)</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF plots</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>ggacf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">type=</span><span class="st">"correlation"</span>, <span class="at">xlab=</span><span class="st">"Lag"</span>, <span class="at">ylab=</span><span class="cn">NULL</span>,</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim=</span><span class="cn">NULL</span>, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">ci.col=</span><span class="st">"blue"</span>, <span class="at">lag.max=</span><span class="cn">NULL</span>) {</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(x)</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>  x.acf <span class="ot">&lt;-</span> <span class="fu">acf</span>(x, <span class="at">plot=</span>F, <span class="at">lag.max=</span>lag.max, <span class="at">type=</span>type)</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>  ci.line <span class="ot">&lt;-</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">-</span> ci) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(x.acf<span class="sc">$</span>n.used)</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>  d.acf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lag=</span>x.acf<span class="sc">$</span>lag, <span class="at">acf=</span>x.acf<span class="sc">$</span>acf)</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d.acf, <span class="fu">aes</span>(<span class="at">x=</span>lag, <span class="at">y=</span>acf)) <span class="sc">+</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend=</span>lag, <span class="at">yend=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>ci.line, <span class="at">color=</span>ci.col, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="sc">-</span>ci.line, <span class="at">color=</span>ci.col, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Lag"</span>) <span class="sc">+</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">ifelse</span>(<span class="fu">is.null</span>(main), <span class="st">""</span>, main)) <span class="sc">+</span></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(ylab))</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">"partial"</span>, <span class="st">"PACF"</span>, <span class="st">"ACF"</span>))</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(ylab)</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>spxl_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>SPXL_r, <span class="at">main =</span> <span class="st">"SPXL"</span>)</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>spxl_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>SPXL_r <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"SPXL Squared"</span>)</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>bac_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>BAC_r, <span class="at">main =</span> <span class="st">"BAC"</span>)</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>bac_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(daily_df<span class="sc">$</span>BAC_r <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"BAC Squared"</span>)</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>(spxl_acf <span class="sc">+</span> spxl_acf2) <span class="sc">/</span> (bac_acf <span class="sc">+</span> bac_acf2)</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>spxl <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>SPXL_r)</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>bac <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(daily_df<span class="sc">$</span>BAC_r)</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting an AR(1) + GARCH(1,1) Model</span></span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>spxl_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>spxl_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(spxl_spec, <span class="at">data =</span> spxl)</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>bac_spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model=</span><span class="fu">list</span>(<span class="at">armaOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variance.model=</span><span class="fu">list</span>(<span class="at">garchOrder=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>bac_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(bac_spec, <span class="at">data =</span> bac)</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized Residuals</span></span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>spxl_res <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">residuals</span>(spxl_fit, <span class="at">standardize =</span> T))</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>bac_res <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">residuals</span>(bac_fit, <span class="at">standardize =</span> T))</span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting t-distribution</span></span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>spxl_res_t <span class="ot">&lt;-</span> <span class="fu">fitdistr</span>(spxl_res, <span class="st">"t"</span>)</span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>bac_res_t <span class="ot">&lt;-</span> <span class="fu">fitdistr</span>(bac_res, <span class="st">"t"</span>)</span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting t-density plots</span></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(spxl_res)</span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">:</span>n)<span class="sc">/</span>(n<span class="sc">+</span><span class="dv">1</span>), <span class="at">df =</span> <span class="dv">5</span>)</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">:</span>n)<span class="sc">/</span>(n<span class="sc">+</span><span class="dv">1</span>), <span class="at">df =</span> <span class="dv">5</span>)</span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="fu">sort</span>(spxl_res), x1, <span class="at">xlab=</span><span class="st">"Standardized Residuals"</span>,</span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">"t-quantiles"</span>,</span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"SPXL Residual t-plot, DF = 5"</span>)</span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="fu">sort</span>(bac_res), x2, <span class="at">xlab=</span><span class="st">"Standardized Residuals"</span>,</span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">"tquantiles"</span>,</span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"BAC Residual t-plot, DF = 5"</span>)</span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform residues into uniform distribution</span></span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>spxl_uniform <span class="ot">&lt;-</span> <span class="fu">pt</span>(spxl_res, <span class="at">df =</span> spxl_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>bac_uniform <span class="ot">&lt;-</span> <span class="fu">pt</span>(bac_res, <span class="at">df =</span> bac_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>U_hat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_uniform, bac_uniform)</span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(U_hat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SPXL_U"</span>, <span class="st">"BAC_U"</span>)</span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">cor.test</span>(spxl_uniform, bac_uniform, </span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method=</span><span class="st">"kendall"</span>)<span class="sc">$</span>estimate)</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> <span class="fu">sin</span>(tau <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit t-Copula</span></span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>Ct <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start =</span> <span class="fu">c</span>(omega, <span class="dv">10</span>))</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-Likelihood</span></span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>log_lik_t <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Ct<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>                          <span class="at">copula =</span> <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>aic_t <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Ct<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(log_lik_t))</span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>aic_t</span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Gaussian Copula</span></span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a>Cgauss <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat, </span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>, <span class="at">start=</span><span class="fu">c</span>(omega))</span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a>log_lik_gauss <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cgauss<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat, </span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a>                              <span class="at">copula =</span> <span class="fu">normalCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a>aic_gauss <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cgauss<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_gauss))</span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a>aic_gauss</span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Gumbel Copula</span></span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>C_gumbel <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span>U_hat,</span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a>log_lik_gumbel <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_gumbel<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a>                               <span class="at">copula =</span> <span class="fu">gumbelCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a>aic_gumbel <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_gumbel<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_gumbel))</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a>aic_gumbel</span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Clayton Copula</span></span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a>C_clayton <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a>log_lik_clayton <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> C_clayton<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a>                                <span class="at">copula =</span> <span class="fu">claytonCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a>aic_clayton <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(C_clayton<span class="sc">@</span>estimate)) <span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">abs</span>(log_lik_clayton))</span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a>aic_clayton</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Frank Copula</span></span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a>Cfrank <span class="ot">&lt;-</span> <span class="fu">fitCopula</span>(<span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="dv">1</span>, <span class="at">dim =</span> <span class="dv">2</span>), <span class="at">data =</span> U_hat,</span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ml"</span>)</span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a>log_lik_frank <span class="ot">&lt;-</span> <span class="fu">loglikCopula</span>(<span class="at">param =</span> Cfrank<span class="sc">@</span>estimate, <span class="at">u =</span> U_hat,</span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a>                              <span class="at">copula =</span> <span class="fu">frankCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a>aic_frank <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(Cfrank<span class="sc">@</span>estimate)) <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span><span class="fu">abs</span>(log_lik_frank))</span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a>aic_frank</span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a>spxl_res_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(spxl_res, <span class="at">main =</span> <span class="st">"SPXL Std. Residuals"</span>)</span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a>spxl_res_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(spxl_res <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Squared SPXL Std. Residuals"</span>)</span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a>bac_res_acf <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(bac_res, <span class="at">main =</span> <span class="st">"BAC Std. Residuals"</span>)</span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a>bac_res_acf2 <span class="ot">&lt;-</span> <span class="fu">ggacf</span>(bac_res <span class="sc">**</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Squared BAC Std. Residuals"</span>)</span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a>(spxl_res_acf <span class="sc">+</span> spxl_res_acf2) <span class="sc">/</span> (bac_res_acf <span class="sc">+</span> bac_res_acf2)</span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(spxl_fit)</span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(bac_fit)</span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Copula Simulation </span></span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">1</span>]</span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> Ct<span class="sc">@</span>estimate[<span class="dv">2</span>]</span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a>simulate <span class="ot">&lt;-</span> <span class="fu">rCopula</span>(b, <span class="fu">tCopula</span>(<span class="at">dim =</span> <span class="dv">2</span>, rho, <span class="at">df =</span> df))</span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a>spxl_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">1</span>], <span class="at">df =</span> spxl_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a>bac_marginal <span class="ot">&lt;-</span> <span class="fu">qt</span>(simulate[, <span class="dv">2</span>], <span class="at">df =</span> bac_res_t<span class="sc">$</span>estimate[<span class="dv">3</span>])</span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe with transformed marginals</span></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spxl_marginal, bac_marginal)</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting sigmas</span></span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a>spxl_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(spxl_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a>bac_pred <span class="ot">&lt;-</span> <span class="fu">ugarchforecast</span>(bac_fit, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a>spxl_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(spxl_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a>bac_sigma <span class="ot">&lt;-</span> <span class="fu">sigma</span>(bac_pred) <span class="co"># sigma_{t + 1}</span></span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize parameters</span></span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>s_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a>s_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(spxl_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a>s_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl[<span class="fu">length</span>(spxl)], b)</span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a>s_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(spxl_sigma, b)</span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a>b_mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">1</span>]), b)</span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a>b_ar <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(bac_fit<span class="sc">@</span>fit<span class="sc">$</span>coef[<span class="dv">2</span>]), b)</span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a>b_last <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac[<span class="fu">length</span>(bac)], b)</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a>b_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(bac_sigma, b)</span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s_mu <span class="sc">+</span> (s_ar <span class="sc">*</span> s_last) <span class="sc">+</span> (s_sd <span class="sc">*</span> sim[, <span class="dv">1</span>])</span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a>ba <span class="ot">&lt;-</span> b_mu <span class="sc">+</span> (b_ar <span class="sc">*</span> b_last) <span class="sc">+</span> (b_sd <span class="sc">*</span> sim[, <span class="dv">2</span>])</span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a>pred_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(s, ba)</span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a>rhos <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>var_sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span>  <span class="fl">0.01</span> <span class="co"># 99th percentile</span></span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>portfolio_value <span class="ot">&lt;-</span> <span class="dv">1000000</span></span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> rhos){</span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a>  s_rho <span class="ot">&lt;-</span> s <span class="sc">*</span> <span class="fu">rep</span>(i, b)</span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a>  b_rho <span class="ot">&lt;-</span> ba <span class="sc">*</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">-</span> i, b)</span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a>  sample <span class="ot">&lt;-</span>  s_rho <span class="sc">+</span> b_rho</span>
<span id="cb18-268"><a href="#cb18-268" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(sample, alpha))</span>
<span id="cb18-269"><a href="#cb18-269" aria-hidden="true" tabindex="-1"></a>  VaR <span class="ot">&lt;-</span> <span class="sc">-</span> portfolio_value <span class="sc">*</span> q</span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a>  var_sample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(var_sample, VaR)</span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VaR ($)"</span>)</span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(var_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"p = 0.1"</span>, <span class="st">"p = 0.2"</span>, <span class="st">"p = 0.3"</span>, <span class="st">"p = 0.4"</span>, </span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.5"</span>, <span class="st">"p = 0.6"</span>, <span class="st">"p = 0.7"</span>, <span class="st">"p = 0.8"</span>, </span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"p = 0.9"</span>)</span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a>var_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>